<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>schwasm</title>
</head>

<body>
    <div id="console">
    </div>
</body>
<script>
    var typeMask = 0b11;
    var typeShift = 2;

    var fixnumTag = 0b00;
    var booleanTag = 0b01;
    var nullTag = 0b10;

    var schemeToVal = function(expr) {
        if ((expr & typeMask) == fixnumTag) {
            return expr >> typeShift;
        } else if ((expr & typeMask) == booleanTag) {
            return (expr >> typeShift) == 1;
        } else if ((expr & typeMask) == nullTag) {
            return null;
        }
    }

    var doExec = function(m) {
        var main = m.instance.exports.main;

        var out = main();
        console.log(schemeToVal(out));
    }

    fetch("bin/a.wasm")
        .then(response => response.arrayBuffer())
        .then(bytes => WebAssembly.instantiate(bytes, {}))
        .then(m => doExec(m));
</script>
</html>